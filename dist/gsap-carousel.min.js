function horizontalLoop(e,t={}){if("undefined"==typeof window)return console.error("horizontalLoop: Window object not available"),null;if("undefined"==typeof gsap)return console.error("horizontalLoop: GSAP library not found"),null;const n=resolveElement(e);if(!n)return null;const o=Array.from(n.children);if(0===o.length)return console.warn("horizontalLoop: No child elements found in container"),null;const r=validateAndMergeConfig(t),{debug:a}=r,s=createLogger(a);s("Initializing horizontal loop with config:",r);const i={isDestroyed:!1,timeline:null,navigation:null,dots:[],resizeObserver:null,autoplayDelay:null,eventListeners:new Map,isProgrammaticNavigation:!1,eventManager:makeEventManager()};try{const e=initializeCarousel(n,o,r,i,s);return e?(e.cleanup=createCleanupFunction(i,r,s),a&&(e.getState=()=>({...i,config:r}),e.log=s),s("Carousel initialized successfully"),e):(s("Failed to initialize carousel"),null)}catch(e){return console.error("horizontalLoop: Initialization failed:",e),cleanup(i,r,s),null}}function validateAndMergeConfig(e){const t={responsive:null,speed:1,gap:"0px",draggable:!1,repeat:0,paused:!0,autoplayDelay:0,reversed:!1,prevNav:null,nextNav:null,dots:null,snap:1,onChange:null,center:!1,updateOnlyOnSettle:!1,onInitialized:null,ariaLabel:"Carousel",debug:!1,accessibilityEnabled:!0},n={...t};for(const[o,r]of Object.entries(e))o in t?n[o]=validateConfigValue(o,r,t[o]):console.warn(`horizontalLoop: Unknown config option "${o}"`);return n.responsive&&"object"!=typeof n.responsive&&(console.warn("horizontalLoop: responsive config must be an object"),n.responsive=null),n}function validateConfigValue(e,t,n){switch(e){case"speed":const e="string"==typeof t?parseFloat(t):t;return"number"==typeof e&&e>0?e:n;case"snap":if(!1===t)return!1;const o="string"==typeof t?parseInt(t,10):t;return"number"==typeof o&&o>=0?o:n;case"gap":return"number"==typeof t?`${t}px`:"string"==typeof t&&t.trim()?t.trim():n;case"autoplayDelay":const r="number"==typeof t?t:parseInt(t,10);return r>=0?r:n;case"onChange":case"onInitialized":return"function"==typeof t?t:n;default:return t}}function createLogger(e){return e?console.log.bind(console,"[HorizontalLoop]"):()=>{}}function makeEventManager(){const e=[];return{on:(t,n,o,r)=>(t.addEventListener(n,o,r),e.push({target:t,type:n,handler:o,options:r}),o),offAll(){for(const{target:t,type:n,handler:o,options:r}of e)try{t.removeEventListener(n,o,r)}catch(e){}e.length=0}}}function resolveElement(e){if("string"==typeof e){const t=gsap.utils.toArray(e)[0]||null;return t||console.error(`resolveElement: No element found for selector "${e}"`),t}return e instanceof Element?e:(console.error(`resolveElement: Invalid target, expected selector or Element. Not "${typeof e}" ${e}"`),null)}function initializeCarousel(e,t,n,o,r){initStyles(e,t,n),n.responsive&&setupResponsiveHandling(e,t,n,o,r);const a=createTimeline(e,t,n,o,r);if(!a)return null;if(setupNavigation(a,e,n,o,r),createDotsElements(a,t,e,n,o,r),setupAutoplay(a,n,o,r),setupAccessibility(a,e,t,n,o,r),setupUnifiedUpdate(a,t,n,o,r),o.timeline=a,updateDots(o.dots,0),n.onInitialized)try{n.onInitialized(createPayload(0,a,t,n))}catch(e){r("Error in onInitialized callback:",e)}return r("Carousel initialized successfully"),a}function createTimeline(e,t,n,o,r){try{let a;const s=gsap.timeline({repeat:n.repeat,paused:n.autoplayDelay>0||n.paused,defaults:{ease:"none"},onReverseComplete:function(){o.isDestroyed||s.totalTime(s.rawTime()+100*s.duration())}});return populateTimeline(s,e,t,n,r)?(addNavigationMethods(s,t,n,o,r),n.draggable&&"undefined"!=typeof Draggable&&setupDraggable(s,t,n,o,r),n.reversed&&!n.autoplayDelay&&(s.vars.onReverseComplete(),s.reverse()),a=s,a):null}catch(e){return r("Error creating timeline:",e),null}}function populateTimeline(e,t,n,o,r){try{const t=n.length,a=100*o.speed,s=parseFloat(o.gap)||0,i=!1===o.snap?e=>e:gsap.utils.snap(o.snap||1),l=o.center,c=!0===l?n[0].parentNode:gsap.utils.toArray(l)[0]||n[0].parentNode,u=n[0].offsetLeft;let p,d=[],f=[],g=[],y=[],h=0;const v=()=>n[t-1].offsetLeft+f[t-1]/100*d[t-1]-u+g[0]+n[t-1].offsetWidth*gsap.getProperty(n[t-1],"scaleX")+s,b=()=>{let e,t=c.getBoundingClientRect();n.forEach((n,o)=>{try{d[o]=parseFloat(gsap.getProperty(n,"width","px"))||0,f[o]=i(parseFloat(gsap.getProperty(n,"x","px"))/d[o]*100+gsap.getProperty(n,"xPercent")),e=n.getBoundingClientRect(),g[o]=e.left-(o?t.right:t.left),t=e}catch(e){return r(`Error calculating dimensions for item ${o}:`,e),!1}}),gsap.set(n,{xPercent:e=>f[e]}),p=v()};let m;const x=()=>{h=l?e.duration()*(c.offsetWidth/2)/p:0,l&&y.forEach((t,n)=>{y[n]=m(e.labels["label"+n]+e.duration()*d[n]/2/p-h)})};gsap.set(n,{x:0}),b(),e.clear();for(let o=0;o<t;o++){const t=n[o],r=f[o]/100*d[o],s=t.offsetLeft+r-u+g[0],l=s+d[o]*gsap.getProperty(t,"scaleX");e.to(t,{xPercent:i((r-l)/d[o]*100),duration:l/a},0).fromTo(t,{xPercent:i((r-l+p)/d[o]*100)},{xPercent:f[o],duration:(r-l+p-r)/a,immediateRender:!1},l/a).add("label"+o,s/a),y[o]=s/a}return m=gsap.utils.wrap(0,e.duration()),x(),l?e.time(y[0],!0):e.progress(1,!0).progress(0,!0),e._widths=d,e._times=y,e._xPercents=f,e._timeWrap=m,e._totalWidth=p,e._timeOffset=h,e._populateWidths=b,e._populateOffsets=x,e._loopContainer=c,e._config=o,!0}catch(e){return r("Error populating timeline:",e),!1}}function getTotalWidth(e,t,n,o,r,a){const s=e.length;return e[s-1].offsetLeft+n[s-1]/100*t[s-1]-o+r[0]+e[s-1].offsetWidth*gsap.getProperty(e[s-1],"scaleX")+a}function addNavigationMethods(e,t,n,o,r){const a=t.length,s=e._timeWrap;let i=0,l=!1;const c=a=>{if(!o.isDestroyed)try{let o=e.progress();e.progress(0,!0),e._populateWidths(),a&&populateTimeline(e,e._loopContainer,t,n,r),e._populateOffsets(),a&&e.draggable&&e.paused()?e.time(e._times[i],!0):e.progress(o,!0)}catch(e){r("Error in refresh:",e)}};e.toIndex=function(l,c={}){if(o.isDestroyed)return this;try{const u=this._times;Math.abs(l-i)>a/2&&(l+=l>i?-a:a);let p=gsap.utils.wrap(0,a,l),d=u[p];if(d>this.time()!=l>i&&l!==i&&(d+=this.duration()*(l>i?1:-1)),(d<0||d>this.duration())&&(c.modifiers={time:s}),i=p,c.overwrite=!0,this._proxy&&gsap.killTweensOf(this._proxy),scheduleAutoplay(this,n,o,r),n.updateOnlyOnSettle&&0!==c.duration){o.isProgrammaticNavigation=!0;const a=c.onComplete;c.onComplete=function(){if(o.isProgrammaticNavigation=!1,!o.isDestroyed){const a=e.closestIndex(!0);if(updateDots(o.dots,a),n.onChange)try{n.onChange(createPayload(a,e,t,n))}catch(e){r("Error in onChange callback:",e)}}a&&a.call(this)}}return 0===c.duration?this.time(s(d)):this.tweenTo(d,c)}catch(e){return r("Error in toIndex:",e),this}},e.closestIndex=function(e){if(o.isDestroyed)return 0;try{const t=getClosest(this._times,this.time(),this.duration());return e&&(i=t,l=!1),t}catch(e){return r("Error in closestIndex:",e),0}},e.pauseAutoplay=()=>{o.isDestroyed||(e.pause(),killAutoplay(o))},e.playAutoplay=()=>{o.isDestroyed||(!n.autoplayDelay>0?n.reversed?e.reverse():e.play():scheduleAutoplay(e,n,o,r))},e.current=()=>l?e.closestIndex(!0):i,e.next=t=>e.toIndex(e.current()+1,t),e.previous=t=>e.toIndex(e.current()-1,t),e.refresh=c;o.eventManager.on(window,"resize",()=>c(!0))}function getClosest(e,t,n){let o,r=e.length,a=1e10,s=0;for(;r--;)o=Math.abs(e[r]-t),o>n/2&&(o=n-o),o<a&&(a=o,s=r);return s}function setupUnifiedUpdate(e,t,n,o,r){(n.onChange||n.dots||n.accessibilityEnabled)&&e.eventCallback("onUpdate",function(){if(!o.isDestroyed){if(n.onChange||n.dots)try{if(!n.updateOnlyOnSettle||!e.draggable?.isDragging&&!e.draggable?.isThrowing&&!o.isProgrammaticNavigation){const e=this.closestIndex();if(!o.isDestroyed&&(updateDots(o.dots,e),n.onChange))try{n.onChange(createPayload(e,this,t,n))}catch(e){r("Error in onChange callback:",e)}}}catch(e){r("Error in change detection:",e)}if(n.accessibilityEnabled&&o.accessibility?.updateActive)try{const e="function"==typeof this.closestIndex?this.closestIndex(!1):0;o.accessibility.updateActive(e)}catch(e){r("Error in accessibility update:",e)}}})}function createPayload(e,t,n,o){return{currentItem:n[e],currentIndex:e,totalItems:n.length,progress:t.progress(),slideWidth:t._widths?.[e]||0,timeline:t,config:{...o}}}function setupResponsiveHandling(e,t,n,o,r){const a=throttle(()=>{o.isDestroyed||setupResponsiveStyles(e,t,n,r)},250);"undefined"!=typeof ResizeObserver?(o.resizeObserver=new ResizeObserver(a),o.resizeObserver.observe(e)):o.eventManager.on(window,"resize",a,{passive:!0}),a()}function throttle(e,t){let n,o=0;return function(...r){const a=Date.now();a-o>t?(e.apply(this,r),o=a):(clearTimeout(n),n=setTimeout(()=>{e.apply(this,r),o=Date.now()},t-(a-o)))}}function setupResponsiveStyles(e,t,n,o){try{const o=window.innerWidth,r=Object.keys(n.responsive).map(Number).sort((e,t)=>e-t);let a=n.responsive[r[0]]?.items||1;for(const e of r)o>=e&&n.responsive[e]?.items&&(a=n.responsive[e].items);if(e.style.getPropertyValue("--items-per-row")!==String(a)){e.style.setProperty("--items-per-row",a);const n="0 0 calc(100% / var(--items-per-row) - (var(--gap) * (var(--items-per-row) - 1) / var(--items-per-row)))";t.forEach(e=>{e.style.flex!==n&&(e.style.flex=n)})}}catch(e){o("Error in responsive styles:",e)}}function killAutoplay(e){if(e.autoplayCall){try{e.autoplayCall.kill()}catch(e){console.log("Error killing autoplay call:",e)}e.autoplayCall=null}}function scheduleAutoplay(e,t,n,o){t.paused||t.autoplayDelay<=0||n.isDestroyed||(killAutoplay(n),n.autoplayCall=gsap.delayedCall(t.autoplayDelay,()=>{if(!n.isDestroyed){try{t.reversed?e.previous():e.next()}catch(e){o?.error?o.error("Autoplay advance error",e):console.error(e)}!t.paused&&!n.isDestroyed&&t.autoplayDelay>0&&scheduleAutoplay(e,t,n,o)}}))}function setupAutoplay(e,t,n,o){if(t.paused||t.autoplayDelay<=0)return;killAutoplay(n);n.eventManager.on(document,"visibilitychange",()=>{n.isDestroyed||(document.hidden?(e.pause(),killAutoplay(n)):t.paused||(e.paused()||(t.reversed?e.reverse():e.play()),scheduleAutoplay(e,t,n,o)))},{passive:!0}),n.eventManager.on(window,"blur",()=>{n.isDestroyed||(e.pause(),killAutoplay(n))},{passive:!0}),n.eventManager.on(window,"focus",()=>{n.isDestroyed||t.paused||scheduleAutoplay(e,t,n,o)},{passive:!0}),t.paused||scheduleAutoplay(e,t,n,o)}function setupNavigation(e,t,n,o,r){if(n.prevNav||n.nextNav)try{o.navigation=createNavigationElements(e,t,n,o,r)}catch(e){(r?.error||console.error)("setupNavigation error:",e)}}function createNavigationElements(e,t,n,o,r){const a=o.eventManager,s=e=>Array.isArray(e)?e:[e,{}],[i,l]=s(n.prevNav||null),[c,u]=s(n.nextNav||null),p=i?resolveElement(i):null,d=c?resolveElement(c):null;if(!p&&!d)return{prevButton:null,nextButton:null};const f=(t,n)=>a=>{if(o.isDestroyed)return;const s=a.currentTarget instanceof HTMLElement?a.currentTarget:a.target;if("keydown"===a.type){if("Enter"!==a.key&&" "!==a.key)return;a.preventDefault()}"click"!==a.type||"A"!==s.tagName&&"A"!==a.target.tagName||a.preventDefault();try{"prev"===t?e.previous(n):e.next(n)}catch(e){(r?.error||console.error)("nav handler error:",e)}},g=p?f("prev",l):null,y=d?f("next",u):null;return p&&(p.setAttribute("role","button"),p.hasAttribute("aria-label")||p.setAttribute("aria-label","Previous slide"),p.tabIndex=p.tabIndex>=0?p.tabIndex:0,a.on(p,"click",g),a.on(p,"keydown",g)),d&&(d.setAttribute("role","button"),d.hasAttribute("aria-label")||d.setAttribute("aria-label","Next slide"),d.tabIndex=d.tabIndex>=0?d.tabIndex:0,a.on(d,"click",y),a.on(d,"keydown",y)),{prevButton:p,nextButton:d}}function createDotsElements(e,t,n,o,r,a){const s=r.eventManager,i=Array.isArray(o.dots)?o.dots[0]:o.dots,l=i?resolveElement(i):null;if(!l)return(a?.debug||console.debug)("Dots: No dots container provided."),r.dots=[],[];l.innerHTML="";const c=document.createDocumentFragment(),u=new Array(t.length);for(let e=0;e<t.length;e++){const t=document.createElement("button");t.type="button",t.className="carousel-dot",t.dataset.index=String(e),t.id=`carousel-dot-${e}`,t.setAttribute("role","tab"),t.setAttribute("aria-selected","false"),t.setAttribute("aria-label",`Go to slide ${e+1}`),t.tabIndex=0,c.appendChild(t),u[e]=t}l.setAttribute("role","tablist"),l.appendChild(c),r.dots=u;return s.on(l,"click",t=>{if(r.isDestroyed)return;const n=t.target.closest("button[data-index]");if(!n||!l.contains(n))return;t.preventDefault();const a=parseInt(n.dataset.index,10);e.toIndex(a,Array.isArray(o.dots)&&o.dots[1]?o.dots[1]:{})}),s.on(l,"keydown",e=>{if(r.isDestroyed)return;if("Enter"!==e.key&&" "!==e.key)return;const t=e.target.closest("button[data-index]");t&&l.contains(t)&&(e.preventDefault(),t.click())}),updateDots(r.dots,e.closestIndex?e.closestIndex(!0):0),u}function updateDots(e,t){if(e&&e.length)for(let n=0;n<e.length;n++){const o=e[n],r=n===t;o.classList.toggle("active",r),o.setAttribute("aria-selected",r?"true":"false"),r?o.setAttribute("aria-current","true"):o.removeAttribute("aria-current")}}function setupAccessibility(e,t,n,o={},r={},a){if(!o.accessibilityEnabled)return;const s=r.eventManager||{on:(e,t,n)=>e.addEventListener(t,n),off:(e,t,n)=>e.removeEventListener(t,n)};t.setAttribute("role","region"),t.setAttribute("aria-roledescription","carousel"),o.ariaLabel&&t.setAttribute("aria-label",o.ariaLabel),t.hasAttribute("tabindex")||t.setAttribute("tabindex","0"),n.forEach((e,t)=>{e.id||(e.id=`hloop-slide-${Math.random().toString(36).slice(2,9)}-${t}`),e.setAttribute("role","group"),e.setAttribute("aria-roledescription","slide"),e.setAttribute("aria-label",`${t+1} of ${n.length}`),e.tabIndex=-1});const i=e=>{e<0||e>=n.length||n.forEach((t,n)=>{const o=n===e;t.tabIndex=o?0:-1,t.classList.toggle("active",o)})};i(0);const l=o=>{const r=document.activeElement;if(t.contains(r)||r===t)switch(o.key){case"ArrowLeft":o.preventDefault(),e.previous();break;case"ArrowRight":o.preventDefault(),e.next();break;case"Home":o.preventDefault(),e.toIndex(0);break;case"End":o.preventDefault(),e.toIndex(n.length-1)}};s.on(t,"keydown",l);if("function"==typeof e.eventCallback)r._accessibilityCallback={type:"eventCallback"};else{let t=-1;const n=()=>{const n="function"==typeof e.closestIndex?e.closestIndex(!1):0;n!==t&&(t=n,i(n))};window.gsap&&window.gsap.ticker&&(window.gsap.ticker.add(n),r._accessibilityTicker=n,r._accessibilityCallback={type:"ticker"})}r.accessibility={updateActive:i,onTimelineUpdate:()=>{if(r.isDestroyed)return;const t="function"==typeof e.closestIndex?e.closestIndex(!1):0;i(t)},onKey:l}}function initStyles(e,t,n){try{e.style.setProperty("--gap",n.gap),e.style.display="flex",e.style.gap="var(--gap)",e.style.overflowX="hidden",n.responsive||t.forEach(e=>{e.style.flex="0 0 auto"})}catch(e){console.warn("Error initializing styles:",e)}}function createCleanupFunction(e,t,n){return function(){if(!e.isDestroyed){n("Cleaning up carousel..."),e.isDestroyed=!0;try{killAutoplay(e),e.eventManager.offAll(),e.resizeObserver&&(e.resizeObserver.disconnect(),e.resizeObserver=null),e.navigation&&(e.navigation=null),e.timeline&&(e.timeline.kill(),e.timeline=null),n("Cleanup completed")}catch(e){n("Error during cleanup:",e)}}}}function cleanup(e,t,n){e.isDestroyed||createCleanupFunction(e,t,n)()}function setupDraggable(e,t,n,o,r){if("undefined"!=typeof Draggable){"undefined"==typeof InertiaPlugin&&r("InertiaPlugin recommended for momentum-based scrolling and snapping");try{const a=document.createElement("div"),s=gsap.utils.wrap(0,1),i=gsap.utils.wrap(0,e.duration()),l=e._times,c=e._widths;!1===n.snap||gsap.utils.snap(n.snap||1);let u,p,d,f,g,y;const h=()=>{const o=t.length,r=e._xPercents||[],a=t[0].offsetLeft,s=e._spaceBefore||[];return t[o-1].offsetLeft+r[o-1]/100*c[o-1]-a+(s[0]||0)+t[o-1].offsetWidth*gsap.getProperty(t[o-1],"scaleX")+(parseFloat(n.gap)||0)},v=()=>{!o.isDestroyed&&e&&d&&e.progress(s(p+(d.startX-d.x)*u))},b=()=>{!o.isDestroyed&&e&&e.closestIndex(!0)},m=function(t){if(Math.abs(p/-u-this.x)<10)return g+y;const n=e.duration();let o=-t*u*n,r=i(o);const a=e.time();e.time(r);const s=e.closestIndex(!1);e.time(a);let c=l[s]-r;return Math.abs(c)>n/2&&(c+=c<0?n:-n),g=(o+c)/n/-u,g};d=Draggable.create(a,{trigger:t[0].parentNode,type:"x",onPressInit(){if(o.isDestroyed)return;const t=this.x;gsap.killTweensOf(e),f=!e.paused(),e.pause(),p=e.progress();const n=h();u=n>0?1/n:1,y=p/-u-t,gsap.set(a,{x:p/-u}),r("Drag init - reusing existing calculations")},onDrag:v,onThrowUpdate:v,overshootTolerance:0,inertia:!0,snap:m,onPress:function(){o.isDestroyed||killAutoplay(o)},onRelease(){o.isDestroyed||(b(),d.isThrowing&&(o.indexIsDirty=!0))},onThrowComplete(){if(!o.isDestroyed){if(b(),f&&(n.reversed?e.reverse():e.play()),n.updateOnlyOnSettle&&(n.onChange||n.dots))try{const a=e.closestIndex(!0);if(n.dots&&o.dots?.length>0&&updateDots(o.dots,a),n.onChange&&"function"==typeof n.onChange){const o=createPayload(a,e,t,n);n.onChange(o)}r(`onThrowComplete: Final position reached at index ${a}`)}catch(e){r("Error in updateOnlyOnSettle callback:",e)}!n.paused&&n.autoplayDelay>0&&scheduleAutoplay(e,n,o,r)}}})[0],e.draggable=d}catch(e){r("Error setting up draggable:",e)}}else r("Draggable plugin not found")}"undefined"!=typeof module&&module.exports?module.exports=horizontalLoop:"function"==typeof define&&define.amd&&define([],()=>horizontalLoop);