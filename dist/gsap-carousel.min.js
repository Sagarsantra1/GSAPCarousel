function horizontalLoop(e,t={}){if("undefined"==typeof window)return console.error("horizontalLoop: Window object not available"),null;if("undefined"==typeof gsap)return console.error("horizontalLoop: GSAP library not found"),null;const n=resolveElement(e);if(!n)return null;const r=Array.from(n.children);if(0===r.length)return console.warn("horizontalLoop: No child elements found in container"),null;const o=validateAndMergeConfig(t),{debug:a}=o,s=createLogger(a);s("Initializing horizontal loop with config:",o);const i={isDestroyed:!1,timeline:null,navigation:null,dots:[],resizeObserver:null,autoplayDelay:null,eventListeners:new Map,isProgrammaticNavigation:!1,eventManager:makeEventManager()};try{const e=initializeCarousel(n,r,o,i,s);return e?(e.cleanup=createCleanupFunction(i,o,s),a&&(e.getState=()=>({...i,config:o}),e.log=s),s("Carousel initialized successfully"),e):(s("Failed to initialize carousel"),null)}catch(e){return console.error("horizontalLoop: Initialization failed:",e),cleanup(i,o,s),null}}function validateAndMergeConfig(e){const t={responsive:null,speed:1,gap:"0px",draggable:!1,repeat:0,paused:!0,autoplayDelay:0,reversed:!1,prevNav:null,nextNav:null,dots:null,snap:1,onChange:null,center:!1,updateOnlyOnSettle:!1,onInitialized:null,ariaLabel:"Carousel",debug:!1,accessibilityEnabled:!0},n={...t};for(const[r,o]of Object.entries(e))r in t?n[r]=validateConfigValue(r,o,t[r]):console.warn(`horizontalLoop: Unknown config option "${r}"`);return n.responsive&&"object"!=typeof n.responsive&&(console.warn("horizontalLoop: responsive config must be an object"),n.responsive=null),n}function validateConfigValue(e,t,n){switch(e){case"speed":const e="string"==typeof t?parseFloat(t):t;return"number"==typeof e&&e>0?e:n;case"snap":if(!1===t)return!1;const r="string"==typeof t?parseInt(t,10):t;return"number"==typeof r&&r>=0?r:n;case"gap":return"number"==typeof t?`${t}px`:"string"==typeof t&&t.trim()?t.trim():n;case"autoplayDelay":const o="number"==typeof t?t:parseInt(t,10);return o>=0?o:n;case"onChange":case"onInitialized":return"function"==typeof t?t:n;default:return t}}function createLogger(e){return e?console.log.bind(console,"[HorizontalLoop]"):()=>{}}function makeEventManager(){const e=[];return{on:(t,n,r,o)=>(t.addEventListener(n,r,o),e.push({target:t,type:n,handler:r,options:o}),r),offAll(){for(const{target:t,type:n,handler:r,options:o}of e)try{t.removeEventListener(n,r,o)}catch(e){}e.length=0}}}function resolveElement(e){if("string"==typeof e){const t=gsap.utils.toArray(e)[0]||null;return t||console.error(`resolveElement: No element found for selector "${e}"`),t}return e instanceof Element?e:(console.error(`resolveElement: Invalid target, expected selector or Element. Not "${typeof e}" ${e}"`),null)}function initializeCarousel(e,t,n,r,o){initStyles(e,t,n),n.responsive&&setupResponsiveHandling(e,t,n,r,o);const a=createTimeline(e,t,n,r,o);if(!a)return null;if(setupNavigation(a,e,n,r,o),createDotsElements(a,t,e,n,r,o),setupAutoplay(a,n,r,o),setupAccessibility(a,e,t,n,r,o),r.timeline=a,updateDots(r.dots,0),n.onInitialized)try{n.onInitialized(createPayload(0,a,t,n))}catch(e){o("Error in onInitialized callback:",e)}return o("Carousel initialized successfully"),a}function createTimeline(e,t,n,r,o){try{let a,s=0;const i=gsap.timeline({repeat:n.repeat,paused:n.autoplayDelay>0||n.paused,defaults:{ease:"none"},onReverseComplete:function(){r.isDestroyed||i.totalTime(i.rawTime()+100*i.duration())}});return populateTimeline(i,e,t,n,o)?(addNavigationMethods(i,t,n,r,o),setupChangeDetection(i,t,n,r,s,o),n.draggable&&"undefined"!=typeof Draggable&&setupDraggable(i,t,n,r,o),n.reversed&&!n.autoplayDelay&&(i.vars.onReverseComplete(),i.reverse()),a=i,a):null}catch(e){return o("Error creating timeline:",e),null}}function populateTimeline(e,t,n,r,o){try{const t=n.length,a=100*r.speed,s=parseFloat(r.gap)||0,i=!1===r.snap?e=>e:gsap.utils.snap(r.snap||1),l=r.center,u=!0===l?n[0].parentNode:gsap.utils.toArray(l)[0]||n[0].parentNode,c=n[0].offsetLeft;let p,d=[],f=[],g=[],y=[],h=0;const v=()=>n[t-1].offsetLeft+f[t-1]/100*d[t-1]-c+g[0]+n[t-1].offsetWidth*gsap.getProperty(n[t-1],"scaleX")+s,m=()=>{let e,t=u.getBoundingClientRect();n.forEach((n,r)=>{try{d[r]=parseFloat(gsap.getProperty(n,"width","px"))||0,f[r]=i(parseFloat(gsap.getProperty(n,"x","px"))/d[r]*100+gsap.getProperty(n,"xPercent")),e=n.getBoundingClientRect(),g[r]=e.left-(r?t.right:t.left),t=e}catch(e){return o(`Error calculating dimensions for item ${r}:`,e),!1}}),gsap.set(n,{xPercent:e=>f[e]}),p=v()};let b;const x=()=>{h=l?e.duration()*(u.offsetWidth/2)/p:0,l&&y.forEach((t,n)=>{y[n]=b(e.labels["label"+n]+e.duration()*d[n]/2/p-h)})};gsap.set(n,{x:0}),m(),e.clear();for(let r=0;r<t;r++){const t=n[r],o=f[r]/100*d[r],s=t.offsetLeft+o-c+g[0],l=s+d[r]*gsap.getProperty(t,"scaleX");e.to(t,{xPercent:i((o-l)/d[r]*100),duration:l/a},0).fromTo(t,{xPercent:i((o-l+p)/d[r]*100)},{xPercent:f[r],duration:(o-l+p-o)/a,immediateRender:!1},l/a).add("label"+r,s/a),y[r]=s/a}return b=gsap.utils.wrap(0,e.duration()),x(),l?e.time(y[0],!0):e.progress(1,!0).progress(0,!0),e._widths=d,e._times=y,e._xPercents=f,e._timeWrap=b,e._totalWidth=p,e._timeOffset=h,e._populateWidths=m,e._populateOffsets=x,e._loopContainer=u,e._config=r,!0}catch(e){return o("Error populating timeline:",e),!1}}function getTotalWidth(e,t,n,r,o,a){const s=e.length;return e[s-1].offsetLeft+n[s-1]/100*t[s-1]-r+o[0]+e[s-1].offsetWidth*gsap.getProperty(e[s-1],"scaleX")+a}function addNavigationMethods(e,t,n,r,o){const a=t.length,s=e._timeWrap;let i=0,l=!1;const u=a=>{if(!r.isDestroyed)try{let r=e.progress();e.progress(0,!0),e._populateWidths(),a&&populateTimeline(e,e._loopContainer,t,n,o),e._populateOffsets(),a&&e.draggable&&e.paused()?e.time(e._times[i],!0):e.progress(r,!0)}catch(e){o("Error in refresh:",e)}};e.toIndex=function(l,u={}){if(r.isDestroyed)return this;try{const c=this._times;Math.abs(l-i)>a/2&&(l+=l>i?-a:a);let p=gsap.utils.wrap(0,a,l),d=c[p];if(d>this.time()!=l>i&&l!==i&&(d+=this.duration()*(l>i?1:-1)),(d<0||d>this.duration())&&(u.modifiers={time:s}),i=p,u.overwrite=!0,this._proxy&&gsap.killTweensOf(this._proxy),scheduleAutoplay(this,n,r,o),n.updateOnlyOnSettle&&0!==u.duration){r.isProgrammaticNavigation=!0;const a=u.onComplete;u.onComplete=function(){if(r.isProgrammaticNavigation=!1,!r.isDestroyed){const a=e.closestIndex(!0);if(updateDots(r.dots,a),n.onChange)try{n.onChange(createPayload(a,e,t,n))}catch(e){o("Error in onChange callback:",e)}}a&&a.call(this)}}return 0===u.duration?this.time(s(d)):this.tweenTo(d,u)}catch(e){return o("Error in toIndex:",e),this}},e.closestIndex=function(e){if(r.isDestroyed)return 0;try{const t=getClosest(this._times,this.time(),this.duration());return e&&(i=t,l=!1),t}catch(e){return o("Error in closestIndex:",e),0}},e.pauseAutoplay=()=>{r.isDestroyed||(e.pause(),killAutoplay(r))},e.playAutoplay=()=>{r.isDestroyed||(!n.autoplayDelay>0?n.reversed?e.reverse():e.play():scheduleAutoplay(e,n,r,o))},e.current=()=>l?e.closestIndex(!0):i,e.next=t=>e.toIndex(e.current()+1,t),e.previous=t=>e.toIndex(e.current()-1,t),e.refresh=u;r.eventManager.on(window,"resize",()=>u(!0))}function getClosest(e,t,n){let r,o=e.length,a=1e10,s=0;for(;o--;)r=Math.abs(e[o]-t),r>n/2&&(r=n-r),r<a&&(a=r,s=o);return s}function setupChangeDetection(e,t,n,r,o,a){if(!n.onChange&&!n.dots)return;let s;e.eventCallback("onUpdate",function(){if(!r.isDestroyed)try{if(!n.updateOnlyOnSettle||!e.draggable?.isDragging&&!e.draggable?.isThrowing&&!r.isProgrammaticNavigation){const e=this.closestIndex();o!==e&&(o=e,clearTimeout(s),s=setTimeout(()=>{r.isDestroyed||(updateDots(r.dots,e),n.onChange&&n.onChange(createPayload(e,this,t,n)))},16))}}catch(e){a("Error in change detection:",e)}})}function createPayload(e,t,n,r){return{currentItem:n[e],currentIndex:e,totalItems:n.length,progress:t.progress(),slideWidth:t._widths?.[e]||0,timeline:t,config:{...r}}}function setupResponsiveHandling(e,t,n,r,o){const a=throttle(()=>{r.isDestroyed||setupResponsiveStyles(e,t,n,o)},250);"undefined"!=typeof ResizeObserver?(r.resizeObserver=new ResizeObserver(a),r.resizeObserver.observe(e)):r.eventManager.on(window,"resize",a,{passive:!0}),a()}function throttle(e,t){let n,r=0;return function(...o){const a=Date.now();a-r>t?(e.apply(this,o),r=a):(clearTimeout(n),n=setTimeout(()=>{e.apply(this,o),r=Date.now()},t-(a-r)))}}function setupResponsiveStyles(e,t,n,r){try{const r=window.innerWidth,o=Object.keys(n.responsive).map(Number).sort((e,t)=>e-t);let a=n.responsive[o[0]]?.items||1;for(const e of o)r>=e&&n.responsive[e]?.items&&(a=n.responsive[e].items);if(e.style.getPropertyValue("--items-per-row")!==String(a)){e.style.setProperty("--items-per-row",a);const n="0 0 calc(100% / var(--items-per-row) - (var(--gap) * (var(--items-per-row) - 1) / var(--items-per-row)))";t.forEach(e=>{e.style.flex!==n&&(e.style.flex=n)})}}catch(e){r("Error in responsive styles:",e)}}function killAutoplay(e){if(e.autoplayCall){try{e.autoplayCall.kill()}catch(e){console.log("Error killing autoplay call:",e)}e.autoplayCall=null}}function scheduleAutoplay(e,t,n,r){t.paused||t.autoplayDelay<=0||n.isDestroyed||(killAutoplay(n),n.autoplayCall=gsap.delayedCall(t.autoplayDelay,()=>{if(!n.isDestroyed){try{t.reversed?e.previous():e.next()}catch(e){r?.error?r.error("Autoplay advance error",e):console.error(e)}!t.paused&&!n.isDestroyed&&t.autoplayDelay>0&&scheduleAutoplay(e,t,n,r)}}))}function setupAutoplay(e,t,n,r){if(t.paused||t.autoplayDelay<=0)return;killAutoplay(n);n.eventManager.on(document,"visibilitychange",()=>{n.isDestroyed||(document.hidden?(e.pause(),killAutoplay(n)):t.paused||(e.paused()||(t.reversed?e.reverse():e.play()),scheduleAutoplay(e,t,n,r)))},{passive:!0}),n.eventManager.on(window,"blur",()=>{n.isDestroyed||(e.pause(),killAutoplay(n))},{passive:!0}),n.eventManager.on(window,"focus",()=>{n.isDestroyed||t.paused||scheduleAutoplay(e,t,n,r)},{passive:!0}),t.paused||scheduleAutoplay(e,t,n,r)}function setupNavigation(e,t,n,r,o){if(n.prevNav||n.nextNav)try{r.navigation=createNavigationElements(e,t,n,r,o)}catch(e){(o?.error||console.error)("setupNavigation error:",e)}}function createNavigationElements(e,t,n,r,o){const a=r.eventManager,s=e=>Array.isArray(e)?e:[e,{}],[i,l]=s(n.prevNav||null),[u,c]=s(n.nextNav||null),p=i?resolveElement(i):null,d=u?resolveElement(u):null;if(!p&&!d)return{prevButton:null,nextButton:null};const f=(t,n)=>a=>{if(r.isDestroyed)return;const s=a.currentTarget instanceof HTMLElement?a.currentTarget:a.target;if("keydown"===a.type){if("Enter"!==a.key&&" "!==a.key)return;a.preventDefault()}"click"!==a.type||"A"!==s.tagName&&"A"!==a.target.tagName||a.preventDefault();try{"prev"===t?e.previous(n):e.next(n)}catch(e){(o?.error||console.error)("nav handler error:",e)}},g=p?f("prev",l):null,y=d?f("next",c):null;return p&&(p.setAttribute("role","button"),p.hasAttribute("aria-label")||p.setAttribute("aria-label","Previous slide"),p.tabIndex=p.tabIndex>=0?p.tabIndex:0,a.on(p,"click",g),a.on(p,"keydown",g)),d&&(d.setAttribute("role","button"),d.hasAttribute("aria-label")||d.setAttribute("aria-label","Next slide"),d.tabIndex=d.tabIndex>=0?d.tabIndex:0,a.on(d,"click",y),a.on(d,"keydown",y)),{prevButton:p,nextButton:d}}function createDotsElements(e,t,n,r,o,a){const s=o.eventManager,i=Array.isArray(r.dots)?r.dots[0]:r.dots,l=i?resolveElement(i):null;if(!l)return(a?.debug||console.debug)("Dots: No dots container provided."),o.dots=[],[];l.innerHTML="";const u=document.createDocumentFragment(),c=new Array(t.length);for(let e=0;e<t.length;e++){const t=document.createElement("button");t.type="button",t.className="carousel-dot",t.dataset.index=String(e),t.id=`carousel-dot-${e}`,t.setAttribute("role","tab"),t.setAttribute("aria-selected","false"),t.setAttribute("aria-label",`Go to slide ${e+1}`),t.tabIndex=0,u.appendChild(t),c[e]=t}l.setAttribute("role","tablist"),l.appendChild(u),o.dots=c;return s.on(l,"click",t=>{if(o.isDestroyed)return;const n=t.target.closest("button[data-index]");if(!n||!l.contains(n))return;t.preventDefault();const a=parseInt(n.dataset.index,10);e.toIndex(a,Array.isArray(r.dots)&&r.dots[1]?r.dots[1]:{})}),s.on(l,"keydown",e=>{if(o.isDestroyed)return;if("Enter"!==e.key&&" "!==e.key)return;const t=e.target.closest("button[data-index]");t&&l.contains(t)&&(e.preventDefault(),t.click())}),updateDots(o.dots,e.closestIndex?e.closestIndex(!0):0),c}function updateDots(e,t){if(e&&e.length)for(let n=0;n<e.length;n++){const r=e[n],o=n===t;r.classList.toggle("active",o),r.setAttribute("aria-selected",o?"true":"false"),o?r.setAttribute("aria-current","true"):r.removeAttribute("aria-current")}}function setupAccessibility(e,t,n,r={},o={},a){if(!r.accessibilityEnabled)return;const s=o.eventManager||{on:(e,t,n)=>e.addEventListener(t,n),off:(e,t,n)=>e.removeEventListener(t,n)};t.setAttribute("role","region"),t.setAttribute("aria-roledescription","carousel"),r.ariaLabel&&t.setAttribute("aria-label",r.ariaLabel),t.hasAttribute("tabindex")||t.setAttribute("tabindex","0"),n.forEach((e,t)=>{e.id||(e.id=`hloop-slide-${Math.random().toString(36).slice(2,9)}-${t}`),e.setAttribute("role","group"),e.setAttribute("aria-roledescription","slide"),e.setAttribute("aria-label",`${t+1} of ${n.length}`),e.setAttribute("aria-hidden","true"),e.tabIndex=-1});const i=e=>{e<0||e>=n.length||n.forEach((t,n)=>{const r=n===e;t.setAttribute("aria-hidden",r?"false":"true"),t.tabIndex=r?0:-1,t.classList.toggle("active",r)})};i(0);const l=r=>{const o=document.activeElement;if(t.contains(o)||o===t)switch(r.key){case"ArrowLeft":r.preventDefault(),e.previous();break;case"ArrowRight":r.preventDefault(),e.next();break;case"Home":r.preventDefault(),e.toIndex(0);break;case"End":r.preventDefault(),e.toIndex(n.length-1)}};s.on(t,"keydown",l);const u=()=>{if(o.isDestroyed)return;const t="function"==typeof e.closestIndex?e.closestIndex(!1):0;i(t)};if("function"==typeof e.eventCallback)e.eventCallback("onUpdate",u),o._accessibilityCallback={type:"eventCallback"};else{let t=-1;const n=()=>{const n="function"==typeof e.closestIndex?e.closestIndex(!1):0;n!==t&&(t=n,i(n))};window.gsap&&window.gsap.ticker&&(window.gsap.ticker.add(n),o._accessibilityTicker=n,o._accessibilityCallback={type:"ticker"})}o.accessibility={updateActive:i,onTimelineUpdate:u,onKey:l}}function initStyles(e,t,n){try{e.style.setProperty("--gap",n.gap),e.style.display="flex",e.style.gap="var(--gap)",e.style.overflowX="hidden",n.responsive||t.forEach(e=>{e.style.flex="0 0 auto"})}catch(e){console.warn("Error initializing styles:",e)}}function createCleanupFunction(e,t,n){return function(){if(!e.isDestroyed){n("Cleaning up carousel..."),e.isDestroyed=!0;try{killAutoplay(e),e.eventManager.offAll(),e.resizeObserver&&(e.resizeObserver.disconnect(),e.resizeObserver=null),e.navigation&&(e.navigation=null),e.timeline&&(e.timeline.kill(),e.timeline=null),n("Cleanup completed")}catch(e){n("Error during cleanup:",e)}}}}function cleanup(e,t,n){e.isDestroyed||createCleanupFunction(e,t,n)()}function setupDraggable(e,t,n,r,o){if("undefined"!=typeof Draggable){"undefined"==typeof InertiaPlugin&&o("InertiaPlugin recommended for momentum-based scrolling and snapping");try{const a=document.createElement("div"),s=gsap.utils.wrap(0,1),i=gsap.utils.wrap(0,e.duration()),l=e._times,u=e._widths;!1===n.snap||gsap.utils.snap(n.snap||1);let c,p,d,f,g,y;const h=()=>{const r=t.length,o=e._xPercents||[],a=t[0].offsetLeft,s=e._spaceBefore||[];return t[r-1].offsetLeft+o[r-1]/100*u[r-1]-a+(s[0]||0)+t[r-1].offsetWidth*gsap.getProperty(t[r-1],"scaleX")+(parseFloat(n.gap)||0)},v=()=>{!r.isDestroyed&&e&&d&&e.progress(s(p+(d.startX-d.x)*c))},m=()=>{!r.isDestroyed&&e&&e.closestIndex(!0)},b=function(t){if(Math.abs(p/-c-this.x)<10)return g+y;const n=e.duration();let r=-t*c*n,o=i(r);const a=e.time();e.time(o);const s=e.closestIndex(!1);e.time(a);let u=l[s]-o;return Math.abs(u)>n/2&&(u+=u<0?n:-n),g=(r+u)/n/-c,g};d=Draggable.create(a,{trigger:t[0].parentNode,type:"x",onPressInit(){if(r.isDestroyed)return;const t=this.x;gsap.killTweensOf(e),f=!e.paused(),e.pause(),p=e.progress();const n=h();c=n>0?1/n:1,y=p/-c-t,gsap.set(a,{x:p/-c}),o("Drag init - reusing existing calculations")},onDrag:v,onThrowUpdate:v,overshootTolerance:0,inertia:!0,snap:b,onPress:function(){r.isDestroyed||killAutoplay(r)},onRelease(){r.isDestroyed||(m(),d.isThrowing&&(r.indexIsDirty=!0))},onThrowComplete(){if(!r.isDestroyed){if(m(),f&&(n.reversed?e.reverse():e.play()),n.updateOnlyOnSettle&&(n.onChange||n.dots))try{const a=e.closestIndex(!0);if(n.dots&&r.dots?.length>0&&updateDots(r.dots,a),n.onChange&&"function"==typeof n.onChange){const r=createPayload(a,e,t,n);n.onChange(r)}o(`onThrowComplete: Final position reached at index ${a}`)}catch(e){o("Error in updateOnlyOnSettle callback:",e)}!n.paused&&n.autoplayDelay>0&&scheduleAutoplay(e,n,r,o)}}})[0],e.draggable=d}catch(e){o("Error setting up draggable:",e)}}else o("Draggable plugin not found")}"undefined"!=typeof module&&module.exports?module.exports=horizontalLoop:"function"==typeof define&&define.amd&&define([],()=>horizontalLoop);